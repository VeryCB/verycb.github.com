<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>VeryCB</title>
    <link href="http://verycb.me/feed.xml" rel="self" />
    <link href="http://verycb.me/" />
    <updated>2013-10-01T14:28:15+08:00</updated>
    <id>http://verycb.me/</id>
    <entry>
        <title type="html"><![CDATA[Clean Git Branch]]></title>
        <author><name>VeryCB</name></author>
        <link href="http://verycb.me/2013/10/01/clean-git-branch.html"/>
        <published>2013-10-01T00:00:00+08:00</published>
        <updated>2013-10-01T13:04:19+08:00</updated>
        <id>http://verycb.me/2013/10/01/clean-git-branch.html</id>
        <category scheme="http://verycb.me/tag/git/" term="git" label="git" />
        <category scheme="http://verycb.me/tag/python/" term="python" label="python" />
        <content type="html" xml:base="http://verycb.me/" xml:lang="en">
            <![CDATA[ <p>之前一直以一种“笨办法”来删 git 分支，比如要删本地分支，直接</p>
<div class="highlight"><pre>git branch -d &lt;branch&gt;
</pre></div>
<p>如果是 remote 分支，就</p>
<div class="highlight"><pre>git push &lt;remote&gt; :&lt;branch&gt;
</pre></div>
<p>但随着项目越来越多，每个项目都可能需要随时在几个不同的 feature 或 bugfix 上切换，而且当一个 branch 用完之后很可能忘记立即删掉，这样导致的结果就是分支积攒的越来越多，删分支的时候就会耗费很多时间和精力（需要不停地重复上面两个命令）。</p>
<p>后来就<a href="http://www.douban.com/people/VeryCB/status/1219353081/">在豆瓣上抱怨了一下</a>，然后<a href="http://houkanshan.github.io">@灭灭</a>就在回应里告诉了我<a href="https://github.com/ornicar/dotfiles/blob/master/scripts/git-branch-cleaner-remote">这个脚本</a>，可以很方便的删 remote 分支（同时还有<a href="https://github.com/ornicar/dotfiles/blob/master/scripts/git-branch-cleaner">一个脚本</a>用来删本地分支）。</p>
<p>这个脚本用 subprocess 模块创建子进程，然后在子进程中调用 git 命令来拿到当前仓库所有的 remote 分支，并且将分支列表写入一个临时文件。你可以编辑这个临时文件，删掉你要删除的分支并保存。然后它会比较编辑之前和编辑之后的分支列表，得到的差集就是你要删除的分支，再调用 git 命令删除之。</p>
<p>于是我就在这个脚本的基础上稍微改了一下，让它既能删 remote 分支，同时也不会放过本地分支。下面是我的版本，也放在 <a href="https://gist.github.com/VeryCB/6759219">Gist 上</a>了：</p>
<div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># This script helps removing Git branches.</span>
<span class="c"># Run it from a git repo dir. It will open the Git branches list</span>
<span class="c"># in your favorite editor. Delete some branches from the list.</span>
<span class="c"># Save and close the file. The script applies the changes to the repo.</span>

<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">call</span><span class="p">,</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">getenv</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c"># configure commands used in this script</span>
<span class="n">editor_command</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s">&#39;EDITOR&#39;</span><span class="p">)</span>
<span class="n">branch_command</span> <span class="o">=</span> <span class="s">&#39;git branch -a&#39;</span>
<span class="n">mktemp_command</span> <span class="o">=</span> <span class="s">&#39;mktemp&#39;</span>

<span class="c"># regex to check whether the branch is a remote branch</span>
<span class="n">remote_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\/&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">is_remote</span><span class="p">(</span><span class="n">branch</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">remote_re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">branch</span><span class="p">))</span>

<span class="c"># takes &#39;git branch&#39; output and returns a set of branches</span>
<span class="k">def</span> <span class="nf">branches_to_list</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">branches</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">branch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39; .+&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">branch</span><span class="o">.</span><span class="n">lstrip</span><span class="p">());</span>
        <span class="k">if</span> <span class="n">is_remote</span><span class="p">(</span><span class="n">branch</span><span class="p">):</span>
            <span class="n">branch</span> <span class="o">=</span> <span class="n">branch</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;remotes/&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">branch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">branches</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">branch</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">branches</span>

<span class="c"># create a temp file</span>
<span class="n">tmp_file</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">mktemp_command</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

<span class="c"># write git branches to the temp file</span>
<span class="n">call</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> &gt; </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">branch_command</span><span class="p">,</span> <span class="n">tmp_file</span><span class="p">),</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># get original branches</span>
<span class="n">original_branches</span> <span class="o">=</span> <span class="n">branches_to_list</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="c"># edit the temp file with the editor command</span>
<span class="n">call</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">editor_command</span><span class="p">,</span> <span class="n">tmp_file</span><span class="p">),</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># get new branches</span>
<span class="n">new_branches</span> <span class="o">=</span> <span class="n">branches_to_list</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="c"># adding and renaming branches is not supported</span>
<span class="k">if</span><span class="p">(</span><span class="n">new_branches</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">original_branches</span><span class="p">)):</span>
    <span class="nb">exit</span><span class="p">(</span><span class="s">&#39;Aborting! Do not add or rename branches, just remove them.&#39;</span><span class="p">)</span>

<span class="c"># remove branches with Git</span>
<span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">original_branches</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">new_branches</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_remote</span><span class="p">(</span><span class="n">branch</span><span class="p">):</span>
        <span class="n">pushable</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39; :&#39;</span><span class="p">,</span> <span class="n">branch</span><span class="p">)</span>
        <span class="n">call</span><span class="p">(</span><span class="s">&#39;git push </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">pushable</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">call</span><span class="p">(</span><span class="s">&#39;git branch -D </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">branch</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
]]>
        </content>
    </entry><entry>
        <title type="html"><![CDATA[Travel To Rome]]></title>
        <author><name>VeryCB</name></author>
        <link href="http://verycb.me/2012/03/29/travel-to-rome.html"/>
        <published>2012-03-29T00:00:00+08:00</published>
        <updated>2013-10-01T14:28:15+08:00</updated>
        <id>http://verycb.me/2012/03/29/travel-to-rome.html</id>
        <category scheme="http://verycb.me/tag/travel/" term="travel" label="travel" />
        <category scheme="http://verycb.me/tag/europe/" term="europe" label="europe" />
        <category scheme="http://verycb.me/tag/italy/" term="italy" label="italy" />
        <category scheme="http://verycb.me/tag/rome/" term="rome" label="rome" />
        <content type="html" xml:base="http://verycb.me/" xml:lang="en">
            <![CDATA[ <p>14日早上，我们从学校坐了四个小时的大巴到伦敦 Stansted 机场，然后又坐了两个半小时飞机，终于抵达此次欧洲大陆行的第一站——罗马。</p>
<p><img src="http://ww1.sinaimg.cn/large/a0c2e9c9gw1drqfpmmcgzj.jpg" alt=""/></p>
<p>提前订了“罗马留学生之家”旅馆，在穷游网上声誉很不错，20欧一晚（多人间）包早晚餐。到旅馆的时候已经晚上9点多了，还好提前让掌柜李阿姨帮我们留着饭。第二天早上李阿姨给我们包了包子，这也是我人肉翻墙一年半以来第一次在异国他乡吃到地道的包子，感动啊&hellip;吃完早饭就正式开始我们的行程了。</p>
<p>从旅馆步行10多分钟就来到了古罗马斗兽场，跟想象中的差不多，非常壮观，只可惜由于地震被损毁，后来甚至还被拆了一部分用来建教堂。不过话说回来，一件东西命运多舛，残留下来的便更显得弥足珍贵，更何况有时候残缺也是一种美呢。</p>
<p><img src="http://ww4.sinaimg.cn/large/a0c2e9c9gw1drqfqesbt2j.jpg" alt=""/></p>
<p>斗兽场的门票是12欧，里面有观众席的遗址，地下的通道以及关野兽的地方。观众席按照社会地位的不同也分为5个区。“最下面前排是贵宾（如元老、长官、祭司等）区，第二层供贵族使用，第三区是给富人使用的，第四区由普通公民使用，最后一区则是给底层妇女使用，全部是站席。”</p>
<p><img src="http://ww2.sinaimg.cn/large/a0c2e9c9gw1drqfr9476sj.jpg" alt=""/></p>
<p>在斗兽场外面可以看到君士坦丁凯旋门，是为了纪念君士坦丁一世在米里维桥战役（Battle of the Milvian Bridge）中大获全胜而建立的。</p>
<p><img src="http://ww4.sinaimg.cn/large/a0c2e9c9gw1drqfrta67vj.jpg" alt=""/></p>
<p>然后我们又去了维托里亚诺纪念堂。从斗兽场到纪念堂沿途能看到很多古罗马的遗迹，可以想象这里曾经有多么繁华和壮丽。维托里亚诺纪念堂是为了纪念在意大利统一过程中战亡的无名英雄而建立的，其宏伟的新古典建筑风格再次将我们震撼。</p>
<p><img src="http://ww1.sinaimg.cn/large/a0c2e9c9gw1drqfsh9ppbj.jpg" alt=""/></p>
<p>从维托里亚诺纪念堂步行20分钟左右到万神庙，再往西便是 Navona 广场。这个广场中间是一个喷泉，喷泉周围有很多兜售油画的小贩（或者是画家在卖自己的作品），还有老年乐队在表演。广场周围有许多意大利餐馆，可以点个 pizza，要点啤酒，坐下来慢慢感受别样的意大利风情。</p>
<p><img src="http://ww3.sinaimg.cn/large/a0c2e9c9gw1drqft0nn8gj.jpg" alt=""/></p>
<p>离开 Navona 广场的时候已经临近傍晚，然后我们又去了传说中的许愿池，作为今天行程的最后一站。许愿池的水从特莱维喷泉底部流出，喷泉上是巴洛克式雕像，水池里都是游人扔进去许愿的硬币。传说闭着眼睛背对着许愿池投硬币，愿望就会成真，只可惜我身上一分零钱都没带，所以什么愿望都没许，其实也就图个乐，要是许愿池真管用的话，这世上也就不会有这么多的战争和贫穷了。</p>
<p><img src="http://ww1.sinaimg.cn/large/a0c2e9c9gw1drqftlnvp9j.jpg" alt=""/></p>
]]>
        </content>
    </entry><entry>
        <title type="html"><![CDATA[Quote From &lt;The Curious Case of Benjamin Button&gt;]]></title>
        <author><name>VeryCB</name></author>
        <link href="http://verycb.me/2010/02/09/quote-from-the-curious-case-of-benjamin-button.html"/>
        <published>2010-02-09T00:00:00+08:00</published>
        <updated>2013-10-01T14:20:57+08:00</updated>
        <id>http://verycb.me/2010/02/09/quote-from-the-curious-case-of-benjamin-button.html</id>
        <category scheme="http://verycb.me/tag/quote/" term="quote" label="quote" />
        <category scheme="http://verycb.me/tag/movie/" term="movie" label="movie" />
        <content type="html" xml:base="http://verycb.me/" xml:lang="en">
            <![CDATA[ <blockquote>
<p>For what it’s worth: it’s never too late or, in my case, too early to be whoever you want to be. There’s no time limit, stop whenever you want. You can change or stay the same, there are no rules to this thing. We can make the best or the worst of it. I hope you make the best of it. And I hope you see things that startle you. I hope you feel things you never felt before. I hope you meet people with a different point of view. I hope you live a life you’re proud of. If you find that you’re not, I hope you have the strength to start all over again.</p>
</blockquote>
<p>一件事无论太晚，或者对我来说太早，都不会阻拦你成为你想成为的那个人。这个过程没有时间的期限，只要你想，随时都可以开始。要改变或者保留原状都无所谓，做事本不应该有所束缚。我们可以办好这件事却也可以把它搞砸，但我希望最终你能成为你想成为的那个人。我希望你有时候能驻足于这个令你感到惊叹的世界，体会你从未有过的感觉，我希望你能见到其他与你观点不同的人们，我希望你能有一个值得自豪的一生。如果和你想象的生活不一样，我希望你能有勇气，重新启程。</p>
<p>From <a href="http://movie.douban.com/subject/1485260/">&lt;The Curious Case of Benjamin Button&gt;</a></p>
]]>
        </content>
    </entry>
</feed>